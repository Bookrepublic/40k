(function(e){var t=function(e){var t,n=Array.prototype.slice;return function(){var r=n.call(arguments),i=this;clearTimeout(t);t=setTimeout(function(){e.apply(i,r)},100)}},n=function(e){var t=e.match(/(\d+)/g);return new Date(t[0],t[1]-1,t[2])},r=function(){function r(t,n){this.$elem=t;this.$results=e(n.results),this.$entries=e(n.entries,this.$results),this.indexDataUrl=n.indexUrl;this.index=this.createIndex();this.template=this.compileTemplate(e(n.template));this.initialize()}r.prototype.initialize=function(){var e=this;this.loadIndexData(function(t){e.populateIndex(t);e.populateSearchFromQuery();e.bindKeypress()})};r.prototype.createIndex=function(){return lunr(function(){this.field("title",{boost:10});this.field("body");this.ref("id")})};r.prototype.compileTemplate=function(e){return Mustache.compile(e.text())};r.prototype.loadIndexData=function(t){e.getJSON(this.indexDataUrl,t)};r.prototype.populateIndex=function(t){var n=this.index;this.entries=e.map(t.entries,this.createEntry);e.each(this.entries,function(e,t){n.add(t)})};r.prototype.createEntry=function(t,r){var i=e.extend({id:r+1},t);t.date&&e.extend(i,{date:n(t.date),pubdate:function(){return dateFormat(n(t.date),"yyyy-mm-dd")},displaydate:function(){return dateFormat(n(t.date),"mmm dd, yyyy")}});return i};r.prototype.bindKeypress=function(){var n=this;this.$elem.bind("keyup",t(function(){n.search(e(this).val())}))};r.prototype.search=function(t){var n=this.entries;if(t.length<=2){this.$results.hide();this.$entries.empty()}else{var r=e.map(this.index.search(t),function(t){return e.grep(n,function(e){return e.id===parseInt(t.ref,10)})[0]});this.displayResults(r)}};r.prototype.displayResults=function(e){var t=this.$entries,n=this.$results;t.empty();e.length===0?t.append("<p>Nothing found.</p>"):t.append(this.template({entries:e}));n.show()};r.prototype.populateSearchFromQuery=function(){var e=new URI(window.location.search.toString()),t=e.search(!0);if(t.hasOwnProperty("q")){this.$elem.val(t.q);this.search(t.q.toString())}};return r}();e.fn.lunrSearch=function(t){t=e.extend({},e.fn.lunrSearch.defaults,t);new r(this,t);return this};e.fn.lunrSearch.defaults={indexUrl:"/search.json",results:"#search-results",entries:".entries",template:"#search-results-template"}})(jQuery);